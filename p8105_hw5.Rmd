---
title: "p8105_hw5"
author: "Tom Carpino, tc2899"
date: "November 8, 2018"
output: html_document
---

This homework flexes our skills on iteration and graphing. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

```

### Problem 1: Case Control Study 

* The format of this problem involves the following: 
    + Importing the dataset
    + Tidying the dataset and creating a usable dataframe 
    + Creating a spaghetti plot 

Loading Packages: 
```{r echo = FALSE}
library(tidyverse)
library(plotly)
library(rvest)
library(magrittr)
```

Listing Files 
```{r}
listed_files = tibble(filepath = list.files("./data/", pattern = "*.csv", full.names = TRUE),
                         filename = basename(filepath))
```

Writing a function to read the data: 

```{r}
read_fx = function(data){
  read_csv(file = data)
}
```

Creating the dataframe using a `map` function: 

```{r, message = FALSE}
df_patient = 
  listed_files %>% 
  mutate(data =  purrr::map(listed_files$filepath, read_fx)) %>% 
  unnest() %>% 
  select(-filepath) %>% 
  gather(key = week, value = value, week_1:week_8) %>% 
  mutate(
    id = str_replace(filename, ".csv",""), 
    week = as.numeric(str_replace(week, "week_", ""))) %>% 
  separate(id, into = c("group", "id"), sep = "_") %>% 
  mutate(id = as.factor(id))

df_patient
```

Creating the Spaghetti Plot: 
```{r spaghetti}
ggplot(
  df_patient, 
  aes(x = week, y = value, color = id, group = id)) + 
  geom_line() +
  facet_grid(~group) +
  labs(
    title = "Observations Over 8 Weeks", 
    x = "Week", 
    y = "Observation", 
    color = "Participant") + 
    viridis::scale_color_viridis(discrete = TRUE)
```

Here one can observe a stark difference in outcomes between the control group, con, and the experimental group, exp. It is clear that the values for the control group remain relatively constant between -1.25 and 3.75 over the course of the 8 weeks, whereas the observation values steadily increase over time from weeks 0 to 8 in the experimental group.  

### Problem 2: Crime in Large Cities 

* The format of this problem involves the following: 
    + Using the existing repo
    + Describing data 
    + Using functions to estimate crime rates
    + Creating plots with CIs

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
